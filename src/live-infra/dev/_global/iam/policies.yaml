# Custom IAM Policies
# Variables available: ${name_prefix}, ${account_id}

# Policy to allow assuming application roles
assume-app-role:
  description: "Allow admin and tester roles to assume application pod roles"
  statements:
    - Effect: "Allow"
      Action:
        - "sts:AssumeRole"
      Resource:
        - "arn:aws:iam::${account_id}:role/*-pod-role"


# Database backup policy matching REQ-DB-002-BACKUP
rds-backup-access:
  description: "Permissions for automated RDS backup and restore"
  statements:
    - Effect: "Allow"
      Action:
        - "rds:CreateDBSnapshot"
        - "rds:DeleteDBSnapshot"
        - "rds:DescribeDBSnapshots"
        - "rds:RestoreDBInstanceFromDBSnapshot"
        - "rds:CopyDBSnapshot"
        - "rds:ModifyDBSnapshotAttribute"
      Resource:
        - "arn:aws:rds:*:${account_id}:db:${name_prefix}-*"
        - "arn:aws:rds:*:${account_id}:snapshot:${name_prefix}-*"
    - Effect: "Allow"
      Action:
        - "rds:ListTagsForResource"
        - "rds:AddTagsToResource"
      Resource: "*"
      Condition:
        StringEquals:
          "aws:RequestedRegion": "${aws_region}"

# General RDS access for developers
rds-access:
  description: "RDS database access for developers"
  statements:
    - Effect: "Allow"
      Action:
        - "rds:Describe*"
        - "rds:List*"
      Resource: "*"
    - Effect: "Allow"
      Action:
        - "rds:ModifyDBInstance"
        - "rds:RebootDBInstance"
        - "rds:CreateDBSnapshot"
      Resource:
        - "arn:aws:rds:*:${account_id}:db:${name_prefix}-*"
      Condition:
        StringEquals:
          "aws:RequestedRegion": "${aws_region}"
